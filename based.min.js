"use strict";var db;!function(){function t(e){clearTimeout(f),l.onmessage=function(i){e.size=(i.data/1024).toFixed(2)+" KB",f=setTimeout(function(){t(e)},5e3)},l.postMessage(JSON.stringify({id:e.getId(s),items:e.items}))}function e(t,e){(t instanceof Object==!1||t instanceof Array==!0)&&c(1002,"Item format is invalid");for(var i in t)-1==this.columnNames.indexOf(i)&&c(1002,"Table does not support this entry ["+i+"]"),this.columns[i].primaryKey&&this.primaryKeys.hasOwnProperty(t[i])&&c(1002,"An item with the same primary key has already been added"),e!==s&&this.columns[i].id&&void 0!==t[i]&&c(1002,"Column ["+i+"] cannot be set as it is an ID column"),this.columns[i].required&&n(t[i])&&c(1002,"["+i+"] is a required field"),void 0!==t[i]&&typeof t[i]!=typeof this.columns[i].type()&&this.columns[i].type!=Object&&c(1002,"["+i+"] was an unexpected type")}function i(){var t=0;for(var e in localStorage)t+=encodeURI(localStorage[e]).split(/%..|./).length-1;return(t/1024).toFixed(2)+" KB"}function n(t){return void 0===t||null===t?!0:!1}function r(t,e){"object"!=typeof t&&c(1,"Can only clone objects and/or arrays");var i=t instanceof Array?[]:{};for(var n in t)i[n]="object"==typeof t[n]&&e===!0?r(t[n],e):t[n];return i}function o(t,e,i,n){t instanceof Object==!1&&c(2001,"Can only query objects"),e instanceof Object||"string"==typeof e||c(2001,"Query is invalid");var o,a=!1,u=new h;"string"==typeof e&&(o={},o[e]=i,e=o);for(var f in t){a=!0;for(var o in e)t[f][o]!=e[o]&&(a=!1);a&&u.push(n===s?t[f]:r(t[f],!0))}return u}var s={},a={0:"Generic Error",1:"System Error",1001:"Table creation error",1002:"Table modification error",2001:"Filter Error"},c=function(t,e){var i=a[t.toString()];if(void 0===i)throw c(1,"Error code not found");throw"["+t+"] "+i+" - "+e},u=function(e,i){"string"==typeof e&&i instanceof Object||c(1001,"Format is invalid");var n=0;this.name=e,this.items=[],this.primaryKeys=[],this.index={},this.columns={},this.columnNames=[],this.size="0 KB",this.getId=function(){return arguments[0]===s?n:void 0},this.getNextId=function(){return arguments[0]===s?n++:void 0},this.setId=function(t){arguments[1]===s&&(n=t)},o(i,{id:!0}).length>1&&c(1001,"You can only have one id column"),o(i,{primaryKey:!0}).length>1&&c(1001,"You can only have one primary key column");for(var r in i)this.columns[r]={id:i[r].id===!0,primaryKey:i[r].primaryKey===!0,required:i[r].primaryKey===!0||i[r].required===!0,type:i[r].hasOwnProperty("type")?i[r].type:Object,name:r},this.columnNames.push(r);t(this),this.sync(!0)};u.prototype={add:function(t,i){e.bind(this)(t,i);for(var n in this.columns)if(this.columns[n].primaryKey&&(this.primaryKeys[t[n]]=0),i===s)this.columns[n].id&&(this.index[t[n].toString()]=t);else if(this.columns[n].id){var r=this.getNextId(s);t[n]=r,this.index[r.toString()]=t}this.items.push(t)},get:function(e,i,n){if(t(this),"number"==typeof e){var a=o(this.columns,{id:!0}).first();if(a){var c=new h;return c.push(n===s?this.index[e.toString()]:r(this.index[e.toString()],!0)),c}}return o(this.items,e,i,n)},update:function(t,i){var n=this;this.get(t,null,s).forEach(function(t){e.bind(n)(i),i=r(i,!0);for(var o in i)t[o]=i[o]})},"delete":function(t){var e=this;this.get(t).forEach(function(t){for(var i in e.columns)if(e.columns[i].id===!0){delete e.index[t[i].toString()];break}e.items.splice(e.items.indexOf(t),1)})},sync:function(t){if(t){var e=localStorage.getItem("table_"+this.name);if(e){e=JSON.parse(e);for(var n=0;n<e.items.length;n++)this.add(e.items[n],s);this.setId(e.id,s)}}else try{localStorage.setItem("table_"+this.name,JSON.stringify({id:this.getId(s),items:this.items}))}catch(r){console.warn("You do not have enough local storage space to sync ["+this.name+"].\nYour local storage is currently using "+i())}},unsync:function(){localStorage.removeItem("table_"+this.name)}};var h=function(){};h.prototype=new Array,h.prototype.first=function(){return this[0]},h.prototype.last=function(){return this[this.length>0?this.length-1:0]},h.prototype.forEach=function(t){"function"!=typeof t&&c(0,"Missing argument");for(var e=0;e<this.length;e++)t(this[e],e)},db={create:function(t,e,i){return new u(t,e,i)}};var f,l=new Worker(window.URL.createObjectURL(new Blob(["onmessage = function (e) { self.postMessage(encodeURI(e.data).split(/%..|./).length - 1); }"])))}();