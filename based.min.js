"use strict";var db;!function(){function t(t,e){(t instanceof Object==!1||t instanceof Array==!0)&&a(1002,"Item format is invalid");for(var n in t)-1==this.columnNames.indexOf(n)&&a(1002,"Table does not support this entry ["+n+"]");for(var n in this.columns)this.columns[n].primaryKey&&this.primaryKeys.hasOwnProperty(t[n])&&a(1002,"An item with the same primary key has already been added"),e!==o&&this.columns[n].id&&void 0!==t[n]&&a(1002,"Column ["+n+"] cannot be set as it is an ID column"),this.columns[n].required&&i(t[n])&&a(1002,"["+n+"] is a required field"),void 0!==t[n]&&typeof t[n]!=typeof this.columns[n].type()&&this.columns[n].type!=Object&&a(1002,"["+n+"] was an unexpected type")}function e(){var t=0;for(var e in localStorage)t+=encodeURI(localStorage[e]).split(/%..|./).length-1;return(t/1024).toFixed(2)+" KB"}function i(t){return void 0===t||null===t?!0:!1}function n(t,e){"object"!=typeof t&&a(1,"Can only clone objects and/or arrays");var i=t instanceof Array?[]:{};for(var r in t)i[r]="object"==typeof t[r]&&e===!0?n(t[r],e):t[r];return i}function r(t,e,i,r){t instanceof Object==!1&&a(2001,"Can only query objects"),e instanceof Object||"string"==typeof e||a(2001,"Query is invalid");var s,c=!1,h=new u;"string"==typeof e&&(s={},s[e]=i,e=s);for(var l in t){c=!0;for(var s in e)t[l][s]!=e[s]&&(c=!1);c&&h.push(r===o?t[l]:n(t[l],!0))}return h}var o={},s={0:"Generic Error",1:"System Error",1001:"Table creation error",1002:"Table modification error",2001:"Filter Error"},a=function(t,e){var i=s[t.toString()];if(void 0===i)throw a(1,"Error code not found");throw"["+t+"] "+i+" - "+e},c=function(t,e){"string"==typeof t&&e instanceof Object||a(1001,"Format is invalid");var i=0;this.name=t,this.items=[],this.primaryKeys=[],this.index={},this.columns={},this.columnNames=[],this.size="0 KB",this.getId=function(){return arguments[0]===o?i:void 0},this.getNextId=function(){return arguments[0]===o?i++:void 0},this.setId=function(t){arguments[1]===o&&(i=t)},r(e,{id:!0}).length>1&&a(1001,"You can only have one id column"),r(e,{primaryKey:!0}).length>1&&a(1001,"You can only have one primary key column");for(var n in e)this.columns[n]={id:e[n].id===!0,primaryKey:e[n].primaryKey===!0,required:e[n].primaryKey===!0||e[n].required===!0,type:e[n].hasOwnProperty("type")?e[n].type:Object,name:n},this.columnNames.push(n);this.sync(!0)};c.prototype={add:function(e,i){t.bind(this)(e,i);for(var r in this.columns)if(this.columns[r].primaryKey&&(this.primaryKeys[e[r]]=0),i===o)this.columns[r].id&&(this.index[e[r].toString()]=e);else if(this.columns[r].id){var s=this.getNextId(o);e[r]=s,this.index[s.toString()]=e}return this.items.push(e),n(e,!0)},get:function(t,e,i){if("number"==typeof t){var s=r(this.columns,{id:!0}).first();if(s){var a=new u;return a.push(i===o?this.index[t.toString()]:n(this.index[t.toString()],!0)),a}}return r(this.items,t,e,i)},all:function(){for(var t=new u,e=n(this.items,!0),i=0;i<e.length;i++)t.push(e[i]);return t},update:function(e,i){var r=this;this.get(e,null,o).forEach(function(e){t.bind(r)(i),i=n(i,!0);for(var o in i)e[o]=i[o]})},"delete":function(t){var e=this;this.get(t).forEach(function(t){for(var i in e.columns)if(e.columns[i].id===!0){delete e.index[t[i].toString()];break}e.items.splice(e.items.indexOf(t),1)})},sync:function(t){if(t){var i=localStorage.getItem("table_"+this.name);if(i){i=JSON.parse(i);for(var n=0;n<i.items.length;n++)this.add(i.items[n],o);this.setId(i.id,o)}}else try{localStorage.setItem("table_"+this.name,JSON.stringify({id:this.getId(o),items:this.items}))}catch(r){console.warn("You do not have enough local storage space to sync ["+this.name+"].\nYour local storage is currently using "+e())}},unsync:function(){localStorage.removeItem("table_"+this.name)}};var u=function(){};u.prototype=new Array,u.prototype.first=function(){return this[0]},u.prototype.last=function(){return this[this.length>0?this.length-1:0]},u.prototype.forEach=function(t){"function"!=typeof t&&a(0,"Missing argument");for(var e=0;e<this.length;e++)t(this[e],e)},db={create:function(t,e,i){return new c(t,e,i)}}}();