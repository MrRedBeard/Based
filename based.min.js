"use strict";var db;!function(){function t(t,e){(t instanceof Object==!1||t instanceof Array==!0)&&a(1002,"Item format is invalid");for(var i in t)-1==this.columnNames.indexOf(i)&&a(1002,"Table does not support this entry ["+i+"]");for(var i in this.columns)this.columns[i].primaryKey&&this.primaryKeys.hasOwnProperty(t[i])&&a(1002,"An item with the same primary key has already been added"),e!==o&&this.columns[i].id&&void 0!==t[i]&&a(1002,"Column ["+i+"] cannot be set as it is an ID column"),this.columns[i].required&&n(t[i])&&a(1002,"["+i+"] is a required field"),n(t[i])||typeof t[i]==typeof this.columns[i].type()||this.columns[i].type==Object||a(1002,"["+i+"] was an unexpected type")}function e(){var t=0;for(var e in localStorage)t+=encodeURI(localStorage[e]).split(/%..|./).length-1;return(t/1024).toFixed(2)+" KB"}function n(t){return void 0===t||null===t?!0:!1}function i(t,e){"object"!=typeof t&&a(1,"Can only clone objects and/or arrays");var n=t instanceof Array?[]:{};for(var r in t)n[r]="object"==typeof t[r]&&e===!0?i(t[r],e):t[r];return n}function r(t,e,n,r){t instanceof Object==!1&&a(2001,"Can only query objects"),e instanceof Object||"string"==typeof e||a(2001,"Query is invalid");var s,c=!1,h=new u;"string"==typeof e&&(s={},s[e]=n,e=s);for(var l in t){c=!0;for(var s in e)t[l][s]!=e[s]&&(c=!1);c&&h.push(r===o?t[l]:i(t[l],!0))}return h}var o={},s={0:"Generic Error",1:"System Error",1001:"Table creation error",1002:"Table modification error",2001:"Filter Error"},a=function(t,e){var n=s[t.toString()];if(void 0===n)throw a(1,"Error code not found");throw"["+t+"] "+n+" - "+e},c=function(t,e){"string"==typeof t&&e instanceof Object||a(1001,"Format is invalid");var n=0;this.name=t,this.items=[],this.primaryKeys=[],this.index={},this.columns={},this.columnNames=[],this.size="0 KB",this.getId=function(){return arguments[0]===o?n:void 0},this.getNextId=function(){return arguments[0]===o?n++:void 0},this.setId=function(t){arguments[1]===o&&(n=t)},r(e,{id:!0}).length>1&&a(1001,"You can only have one id column"),r(e,{primaryKey:!0}).length>1&&a(1001,"You can only have one primary key column");for(var i in e)this.columns[i]={id:e[i].id===!0,primaryKey:e[i].primaryKey===!0,required:e[i].primaryKey===!0||e[i].required===!0,type:e[i].hasOwnProperty("type")?e[i].type:Object,name:i},this.columnNames.push(i);this.sync(!0)};c.prototype={add:function(e,n){t.bind(this)(e,n);for(var r in this.columns)if(this.columns[r].primaryKey&&(this.primaryKeys[e[r]]=0),n===o)this.columns[r].id&&(this.index[e[r].toString()]=e);else if(this.columns[r].id){var s=this.getNextId(o);e[r]=s,this.index[s.toString()]=e}return this.items.push(e),i(e,!0)},get:function(t,e,n){if("number"==typeof t){var s=r(this.columns,{id:!0}).first();if(s){var a=new u;return a.push(n===o?this.index[t.toString()]:i(this.index[t.toString()],!0)),a}}return r(this.items,t,e,n)},all:function(){for(var t=new u,e=i(this.items,!0),n=0;n<e.length;n++)t.push(e[n]);return t},update:function(e,n){var r=this;this.get(e,null,o).forEach(function(e){t.bind(r)(n),n=i(n,!0);for(var o in n)e[o]=n[o]})},"delete":function(t){var e=this;this.get(t).forEach(function(t){for(var n in e.columns)if(e.columns[n].id===!0){delete e.index[t[n].toString()];break}e.items.splice(e.items.indexOf(t),1)})},sync:function(t){if(t){var n=localStorage.getItem("table_"+this.name);if(n){n=JSON.parse(n);for(var i=0;i<n.items.length;i++)this.add(n.items[i],o);this.setId(n.id,o)}}else try{localStorage.setItem("table_"+this.name,JSON.stringify({id:this.getId(o),items:this.items}))}catch(r){console.warn("You do not have enough local storage space to sync ["+this.name+"].\nYour local storage is currently using "+e())}},unsync:function(){localStorage.removeItem("table_"+this.name)}};var u=function(){};u.prototype=new Array,u.prototype.first=function(){return this[0]},u.prototype.last=function(){return this[this.length>0?this.length-1:0]},u.prototype.forEach=function(t){"function"!=typeof t&&a(0,"Missing argument");for(var e=0;e<this.length;e++)t(this[e],e)},db={create:function(t,e,n){return new c(t,e,n)}}}();